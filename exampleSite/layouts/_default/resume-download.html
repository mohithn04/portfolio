{{ define "head" }}
<meta name="description" content="Download {{ .Site.Params.title }} Resume">
<link rel="stylesheet" href="{{.Site.Params.staticPath}}/css/single.css">
<script defer src="{{.Site.Params.staticPath}}/fontawesome-6/all-6.4.2.js"></script>
{{ end }}

{{ define "title" }}
Resume Download | {{ .Site.Title }}
{{ end }}

{{ define "main" }}
<section id="resume-download" class="py-5">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="download-container p-5 bg-light rounded shadow">
          <div class="text-center mb-4">
            <i class="fas fa-file-pdf fa-4x text-primary mb-4"></i>
            <h2 class="mb-3">Access My Resume</h2>
            <p class="lead">I'd love to connect! Please provide your details and I'll send you the resume access password via email.</p>
          </div>

          <!-- Step 1: Form -->
          <div id="formStep" class="step-content">
            <form id="resumeForm" class="needs-validation" novalidate>
              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="firstName" class="form-label">First Name *</label>
                  <input type="text" class="form-control" id="firstName" name="firstName" required>
                  <div class="invalid-feedback">
                    Please provide your first name.
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="lastName" class="form-label">Last Name *</label>
                  <input type="text" class="form-control" id="lastName" name="lastName" required>
                  <div class="invalid-feedback">
                    Please provide your last name.
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <label for="email" class="form-label">Your Email Address *</label>
                <input type="email" class="form-control" id="email" name="email" required>
                <div class="invalid-feedback">
                  Please provide a valid email address.
                </div>
              </div>

              <div class="mb-3">
                <label for="company" class="form-label">Company/Organization</label>
                <input type="text" class="form-control" id="company" name="company">
              </div>

              <div class="mb-3">
                <label for="purpose" class="form-label">What's your interest? *</label>
                <select class="form-select" id="purpose" name="purpose" required>
                  <option value="">Select an option</option>
                  <option value="job_opportunity">Job Opportunity</option>
                  <option value="collaboration">Collaboration</option>
                  <option value="networking">Networking</option>
                  <option value="consulting">Consulting</option>
                  <option value="other">Other</option>
                </select>
                <div class="invalid-feedback">
                  Please select your purpose.
                </div>
              </div>

              <div class="mb-4">
                <label for="message" class="form-label">Tell me about yourself and your interest *</label>
                <textarea class="form-control" id="message" name="message" rows="4" placeholder="Hi Mohith, I'm interested in..." required></textarea>
                <div class="invalid-feedback">
                  Please provide a brief introduction.
                </div>
              </div>

              <div class="text-center">
                <button type="submit" class="btn btn-primary btn-lg px-5" id="submitBtn">
                  <i class="fas fa-envelope me-2"></i>
                  Request Resume Access
                </button>
              </div>
            </form>
          </div>

          <!-- Step 2: Processing -->
          <div id="processingStep" class="step-content text-center" style="display: none;">
            <div class="spinner-border text-primary mb-3" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <h4 class="mb-3">Processing Your Request</h4>
            <p class="lead">Generating secure access and sending email...</p>
            <div class="progress mt-4">
              <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" id="progressBar"></div>
            </div>
          </div>

          <!-- Step 3: Success -->
          <div id="successStep" class="step-content text-center" style="display: none;">
            <div class="success-icon mb-4">
              <i class="fas fa-check-circle fa-5x text-success"></i>
            </div>
            <h3 class="mb-3">Email Sent Successfully!</h3>
            <div class="alert alert-success">
              <h5><i class="fas fa-envelope me-2"></i>Check Your Email</h5>
              <p class="mb-2">I've sent you an email with:</p>
              <ul class="list-unstyled">
                <li>✓ Direct link to my resume</li>
                <li>✓ Password to access the document</li>
                <li>✓ My contact information</li>
              </ul>
            </div>

            <div class="email-info mt-4 p-3 bg-light rounded">
              <h6>Email sent to: <span id="emailAddress" class="text-primary"></span></h6>
              <p class="mb-2 small text-muted">
                <i class="fas fa-info-circle me-1"></i>
                If you don't see the email in your inbox, please check your spam/junk folder.
              </p>
            </div>

            <div class="text-center mt-4">
              <a href="mailto:mohith.n2022@gmail.com" class="btn btn-outline-primary me-3">
                <i class="fas fa-reply me-2"></i>
                Reply to Email
              </a>
              <button type="button" class="btn btn-outline-secondary" id="startOverBtn">
                <i class="fas fa-redo me-2"></i>
                Start Over
              </button>
            </div>
          </div>

          <div class="mt-4 text-center">
            <small class="text-muted">
              <i class="fas fa-shield-alt me-1"></i>
              Your information is secure and will only be used to send you the resume and establish professional contact.
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
let userFormData = {};

document.getElementById('resumeForm').addEventListener('submit', function(e) {
  e.preventDefault();

  // Validate form
  if (!this.checkValidity()) {
    e.stopPropagation();
    this.classList.add('was-validated');
    return;
  }

  // Store form data
  const formData = new FormData(this);
  userFormData = {
    firstName: formData.get('firstName'),
    lastName: formData.get('lastName'),
    email: formData.get('email'),
    company: formData.get('company'),
    purpose: formData.get('purpose'),
    message: formData.get('message'),
    timestamp: new Date().toISOString()
  };

  // Show processing step
  showStep('processingStep');

  // Start progress animation
  animateProgress();

  // Send email (simulate the automated process)
  setTimeout(() => {
    sendResumeEmail();
  }, 3000);
});

function showStep(stepId) {
  // Hide all steps
  document.querySelectorAll('.step-content').forEach(step => {
    step.style.display = 'none';
  });

  // Show selected step
  document.getElementById(stepId).style.display = 'block';
}

function animateProgress() {
  const progressBar = document.getElementById('progressBar');
  let width = 0;
  const interval = setInterval(() => {
    width += 10;
    progressBar.style.width = width + '%';
    if (width >= 100) {
      clearInterval(interval);
    }
  }, 200);
}

function sendResumeEmail() {
  // Generate a unique password (in real implementation, this would be done server-side)
  const password = generatePassword();

  // Log the interaction for your records
  console.log('Resume request processed:', {
    ...userFormData,
    password: password,
    processedAt: new Date().toISOString()
  });

  // In a real implementation, you would:
  // 1. Call your backend API to send the email
  // 2. The backend would use a service like SendGrid, Mailgun, or AWS SES
  // 3. Email would contain the Google Drive link and password

  // For now, simulate successful email sending
  simulateEmailSending(password);
}

function generatePassword() {
  // Generate a secure password (8-10 characters, mix of letters and numbers)
  const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
  let password = '';
  for (let i = 0; i < 8; i++) {
    password += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return password;
}

function simulateEmailSending(password) {
  // This simulates what your automated email would contain
  const emailContent = `
    Subject: Resume Access - ${userFormData.firstName} ${userFormData.lastName}

    Hi ${userFormData.firstName},

    Thank you for your interest in my resume! Here's your secure access:

    📄 Resume Link: https://drive.google.com/file/d/1_iffxAdiC3LP4J89VsUYr1q4dcgCc2AN/view?usp=sharing
    🔐 Password: ${password}

    I appreciate your interest in ${userFormData.purpose.replace('_', ' ')} and look forward to connecting with you.

    Best regards,
    Mohith Nagendra
    mohith.n2022@gmail.com
  `;

  console.log('Email content that would be sent:', emailContent);

  // Show success step
  showStep('successStep');
  document.getElementById('emailAddress').textContent = userFormData.email;
}

// Start over functionality
document.getElementById('startOverBtn').addEventListener('click', function() {
  showStep('formStep');
  document.getElementById('resumeForm').reset();
  document.getElementById('resumeForm').classList.remove('was-validated');
});
</script>

<style>
.form-control:focus, .form-select:focus {
  border-color: #0d6efd;
  box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
}

.btn-primary {
  background-color: #0d6efd;
  border-color: #0d6efd;
}

.btn-primary:hover {
  background-color: #0b5ed7;
  border-color: #0a58ca;
}

.invalid-feedback {
  display: block;
}

.was-validated .form-control:invalid {
  border-color: #dc3545;
}

.was-validated .form-control:valid {
  border-color: #198754;
}

.download-container {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border: 1px solid #dee2e6;
}

.step-content {
  min-height: 400px;
}

.success-icon {
  animation: bounce 2s infinite;
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0);
  }
  40% {
    transform: translateY(-10px);
  }
  60% {
    transform: translateY(-5px);
  }
}

.progress {
  height: 10px;
  border-radius: 5px;
}

.email-info {
  border-left: 4px solid #0dcaf0;
}

/* Force black text for form elements in both light and dark modes */
#resume-download .form-label,
#resume-download .form-control,
#resume-download .form-select,
#resume-download h2,
#resume-download h3,
#resume-download h4,
#resume-download h5,
#resume-download h6,
#resume-download p,
#resume-download .lead,
#resume-download .alert,
#resume-download .text-muted,
#resume-download small {
  color: #000000 !important;
}

/* Ensure form inputs maintain black text */
#resume-download .form-control::placeholder {
  color: #6c757d !important;
}

#resume-download .form-control:focus {
  color: #000000 !important;
}

/* Override theme colors for this section */
#resume-download .download-container {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
  color: #000000 !important;
}

/* Ensure alert text remains black */
#resume-download .alert * {
  color: #000000 !important;
}

/* Dark mode overrides */
[data-theme="dark"] #resume-download .form-label,
[data-theme="dark"] #resume-download .form-control,
[data-theme="dark"] #resume-download .form-select,
[data-theme="dark"] #resume-download h2,
[data-theme="dark"] #resume-download h3,
[data-theme="dark"] #resume-download h4,
[data-theme="dark"] #resume-download h5,
[data-theme="dark"] #resume-download h6,
[data-theme="dark"] #resume-download p,
[data-theme="dark"] #resume-download .lead,
[data-theme="dark"] #resume-download .alert,
[data-theme="dark"] #resume-download .text-muted,
[data-theme="dark"] #resume-download small {
  color: #000000 !important;
}

.dark #resume-download .form-label,
.dark #resume-download .form-control,
.dark #resume-download .form-select,
.dark #resume-download h2,
.dark #resume-download h3,
.dark #resume-download h4,
.dark #resume-download h5,
.dark #resume-download h6,
.dark #resume-download p,
.dark #resume-download .lead,
.dark #resume-download .alert,
.dark #resume-download .text-muted,
.dark #resume-download small {
  color: #000000 !important;
}
</style>
{{ end }}
