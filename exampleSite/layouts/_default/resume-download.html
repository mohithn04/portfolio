{{ define "head" }}
<meta name="description" content="Download {{ .Site.Params.title }} Resume">
<link rel="stylesheet" href="{{.Site.Params.staticPath}}/css/single.css">
<script defer src="{{.Site.Params.staticPath}}/fontawesome-6/all-6.4.2.js"></script>
{{ end }}

{{ define "title" }}
Resume Download | {{ .Site.Title }}
{{ end }}

{{ define "main" }}
<section id="resume-download" class="py-5">
  <div class="container">
    <div class="row justify-content-center">
      <div class="col-lg-8">
        <div class="download-container p-5 bg-light rounded shadow">
          <div class="text-center mb-4">
            <i class="fas fa-file-pdf fa-4x text-primary mb-4"></i>
            <h2 class="mb-3">Access My Resume</h2>
            <p class="lead">I'd love to connect! Please provide your details and I'll automatically send you my resume.</p>
          </div>

          <!-- Step 1: Form -->
          <div id="formStep" class="step-content">
            <form id="resumeForm" name="resume-requests" method="POST" data-netlify="true" class="needs-validation" novalidate>
              <!-- Hidden field for Netlify -->
              <input type="hidden" name="form-name" value="resume-requests" />

              <div class="row">
                <div class="col-md-6 mb-3">
                  <label for="firstName" class="form-label">First Name *</label>
                  <input type="text" class="form-control" id="firstName" name="firstName" required>
                  <div class="invalid-feedback">
                    Please provide your first name.
                  </div>
                </div>
                <div class="col-md-6 mb-3">
                  <label for="lastName" class="form-label">Last Name *</label>
                  <input type="text" class="form-control" id="lastName" name="lastName" required>
                  <div class="invalid-feedback">
                    Please provide your last name.
                  </div>
                </div>
              </div>

              <div class="mb-3">
                <label for="email" class="form-label">Your Email Address *</label>
                <input type="email" class="form-control" id="email" name="email" required>
                <div class="invalid-feedback">
                  Please provide a valid email address.
                </div>
              </div>

              <div class="mb-3">
                <label for="company" class="form-label">Company/Organization</label>
                <input type="text" class="form-control" id="company" name="company">
              </div>

              <div class="mb-3">
                <label for="purpose" class="form-label">What's your interest? *</label>
                <select class="form-select" id="purpose" name="purpose" required>
                  <option value="">Select an option</option>
                  <option value="job_opportunity">Job Opportunity</option>
                  <option value="collaboration">Collaboration</option>
                  <option value="networking">Networking</option>
                  <option value="consulting">Consulting</option>
                  <option value="other">Other</option>
                </select>
                <div class="invalid-feedback">
                  Please select your purpose.
                </div>
              </div>

              <div class="mb-4">
                <label for="message" class="form-label">Tell me about yourself and your interest *</label>
                <textarea class="form-control" id="message" name="message" rows="4" placeholder="Hi Mohith, I'm interested in..." required></textarea>
                <div class="invalid-feedback">
                  Please provide a brief introduction.
                </div>
              </div>

              <!-- Hidden fields for email automation -->
              <input type="hidden" name="timestamp" id="timestamp">
              <input type="hidden" name="subject" value="RESUME REQUEST">

              <div class="text-center">
                <button type="submit" class="btn btn-primary btn-lg px-5" id="submitBtn">
                  <i class="fas fa-envelope me-2"></i>
                  Send Request & Get Resume
                </button>
              </div>
            </form>
          </div>

          <!-- Step 2: Processing -->
          <div id="processingStep" class="step-content text-center" style="display: none;">
            <div class="spinner-border text-primary mb-3" role="status">
              <span class="visually-hidden">Loading...</span>
            </div>
            <h4 class="mb-3">Sending Your Request</h4>
            <p class="lead">Your request is being submitted...</p>
            <div class="progress mt-4">
              <div class="progress-bar progress-bar-striped progress-bar-animated" role="progressbar" style="width: 0%" id="progressBar"></div>
            </div>
          </div>

          <!-- Step 3: Success -->
          <div id="successStep" class="step-content text-center" style="display: none;">
            <div class="success-icon mb-4">
              <i class="fas fa-check-circle fa-5x text-success"></i>
            </div>
            <h3 class="mb-3">Request Sent Successfully!</h3>
            <div class="alert alert-success">
              <h5><i class="fas fa-magic me-2"></i>Automatic Resume Delivery</h5>
              <p class="mb-2">You'll receive an automated email shortly with:</p>
              <ul class="list-unstyled">
                <li>✓ Direct link to my resume</li>
                <li>✓ Password to access the document</li>
                <li>✓ My contact information</li>
              </ul>
            </div>

            <div class="email-info mt-4 p-3 bg-light rounded">
              <h6>Auto-response email will be sent to: <span id="emailAddress" class="text-primary"></span></h6>
              <p class="mb-2 small text-muted">
                <i class="fas fa-info-circle me-1"></i>
                The email is sent automatically within a few minutes. Please check your spam/junk folder if you don't see it.
              </p>
            </div>

            <div class="text-center mt-4">
              <a href="mailto:mohith.n2022@gmail.com" class="btn btn-outline-primary me-3">
                <i class="fas fa-envelope me-2"></i>
                Email Me Directly
              </a>
              <button type="button" class="btn btn-outline-secondary" id="startOverBtn">
                <i class="fas fa-redo me-2"></i>
                Submit Another Request
              </button>
            </div>
          </div>

          <div class="mt-4 text-center">
            <small class="text-muted">
              <i class="fas fa-robot me-1"></i>
              This form triggers an automatic response. You'll receive my resume instantly!
            </small>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
let userFormData = {};

document.getElementById('resumeForm').addEventListener('submit', function(e) {
  e.preventDefault();

  // Validate form
  if (!this.checkValidity()) {
    e.stopPropagation();
    this.classList.add('was-validated');
    return;
  }

  // Store form data
  const formData = new FormData(this);
  userFormData = {
    firstName: formData.get('firstName'),
    lastName: formData.get('lastName'),
    email: formData.get('email'),
    company: formData.get('company'),
    purpose: formData.get('purpose'),
    message: formData.get('message'),
    timestamp: new Date().toISOString()
  };

  // Show processing step
  showStep('processingStep');
  animateProgress();

  // Create email that will trigger Gmail auto-response
  const subject = encodeURIComponent(`RESUME REQUEST - ${userFormData.firstName} ${userFormData.lastName}`);

  let emailBody = `Resume Request Details:\n\n`;
  emailBody += `Name: ${userFormData.firstName} ${userFormData.lastName}\n`;
  emailBody += `Email: ${userFormData.email}\n`;
  emailBody += `Company: ${userFormData.company || 'Not provided'}\n`;
  emailBody += `Purpose: ${userFormData.purpose.replace('_', ' ')}\n`;
  emailBody += `Message: ${userFormData.message}\n`;
  emailBody += `Timestamp: ${userFormData.timestamp}\n\n`;
  emailBody += `Please send resume access to: ${userFormData.email}`;

  const encodedBody = encodeURIComponent(emailBody);
  const mailtoLink = `mailto:mohith.n2022@gmail.com?subject=${subject}&body=${encodedBody}&cc=${userFormData.email}`;

  // Submit to Netlify for tracking
  fetch('/', {
    method: 'POST',
    headers: { "Content-Type": "application/x-www-form-urlencoded" },
    body: new URLSearchParams(new FormData(this)).toString()
  })
  .then(() => {
    setTimeout(() => {
      // Open user's email client to send the request
      window.location.href = mailtoLink;

      // Show success step
      showStep('successStep');
      document.getElementById('emailAddress').textContent = userFormData.email;

      console.log('Resume request initiated:', userFormData);
    }, 2000);
  })
  .catch((error) => {
    console.error('Error:', error);
    alert('There was an error submitting your request. Please try emailing me directly.');
    showStep('formStep');
  });
});

function showStep(stepId) {
  // Hide all steps
  document.querySelectorAll('.step-content').forEach(step => {
    step.style.display = 'none';
  });

  // Show selected step
  document.getElementById(stepId).style.display = 'block';
}

function animateProgress() {
  const progressBar = document.getElementById('progressBar');
  let width = 0;
  const interval = setInterval(() => {
    width += 20;
    progressBar.style.width = width + '%';
    if (width >= 100) {
      clearInterval(interval);
    }
  }, 200);
}

// Start over functionality
document.getElementById('startOverBtn').addEventListener('click', function() {
  showStep('formStep');
  document.getElementById('resumeForm').reset();
  document.getElementById('resumeForm').classList.remove('was-validated');
});
</script>

<style>
.form-control:focus, .form-select:focus {
  border-color: #0d6efd;
  box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
}

.btn-primary {
  background-color: #0d6efd;
  border-color: #0d6efd;
}

.btn-primary:hover {
  background-color: #0b5ed7;
  border-color: #0a58ca;
}

.invalid-feedback {
  display: block;
}

.was-validated .form-control:invalid {
  border-color: #dc3545;
}

.was-validated .form-control:valid {
  border-color: #198754;
}

.download-container {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  border: 1px solid #dee2e6;
}

.step-content {
  min-height: 400px;
}

.success-icon {
  animation: bounce 2s infinite;
}

@keyframes bounce {
  0%, 20%, 50%, 80%, 100% {
    transform: translateY(0);
  }
  40% {
    transform: translateY(-10px);
  }
  60% {
    transform: translateY(-5px);
  }
}

.progress {
  height: 10px;
  border-radius: 5px;
}

.email-info {
  border-left: 4px solid #0dcaf0;
}

/* Force black text for form elements in both light and dark modes */
#resume-download .form-label,
#resume-download .form-control,
#resume-download .form-select,
#resume-download h2,
#resume-download h3,
#resume-download h4,
#resume-download h5,
#resume-download h6,
#resume-download p,
#resume-download .lead,
#resume-download .alert,
#resume-download .text-muted,
#resume-download small {
  color: #000000 !important;
}

/* Ensure form inputs maintain black text */
#resume-download .form-control::placeholder {
  color: #6c757d !important;
}

#resume-download .form-control:focus {
  color: #000000 !important;
}

/* Override theme colors for this section */
#resume-download .download-container {
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%) !important;
  color: #000000 !important;
}

/* Ensure alert text remains black */
#resume-download .alert * {
  color: #000000 !important;
}

/* Dark mode overrides */
[data-theme="dark"] #resume-download .form-label,
[data-theme="dark"] #resume-download .form-control,
[data-theme="dark"] #resume-download .form-select,
[data-theme="dark"] #resume-download h2,
[data-theme="dark"] #resume-download h3,
[data-theme="dark"] #resume-download h4,
[data-theme="dark"] #resume-download h5,
[data-theme="dark"] #resume-download h6,
[data-theme="dark"] #resume-download p,
[data-theme="dark"] #resume-download .lead,
[data-theme="dark"] #resume-download .alert,
[data-theme="dark"] #resume-download .text-muted,
[data-theme="dark"] #resume-download small {
  color: #000000 !important;
}

.dark #resume-download .form-label,
.dark #resume-download .form-control,
.dark #resume-download .form-select,
.dark #resume-download h2,
.dark #resume-download h3,
.dark #resume-download h4,
.dark #resume-download h5,
.dark #resume-download h6,
.dark #resume-download p,
.dark #resume-download .lead,
.dark #resume-download .alert,
.dark #resume-download .text-muted,
.dark #resume-download small {
  color: #000000 !important;
}
</style>
{{ end }}
